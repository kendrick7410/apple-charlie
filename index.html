<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Le Village de Charlie</title>
    <link href="https://fonts.googleapis.com/css2?family=Varela+Round&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body onclick="if(Game&&Game.audio)Game.audio.resume()">

<!-- Time Overlay -->
<div id="time-overlay"></div>

<div id="viewport">
    <div id="game-world"></div>

    <!-- Interior View -->
    <div id="interior-view">
        <div class="room" id="current-room">
            <div id="interior-charlie">ğŸ¤ </div>
            <div class="exit-mat">ğŸŒŸ</div>
        </div>

        <!-- Interior Crafting Panel -->
        <div style="position:fixed;bottom:10px;display:flex;flex-direction:column;align-items:center;gap:6px;z-index:5500;">
            <div class="ui-card" style="padding:10px;display:flex;gap:4px;flex-wrap:wrap;justify-content:center;">
                <button onclick="Game.crafting.craftFurniture('chair')" class="btn-animal btn-craft">ğŸª‘ Chaise (2ğŸªµ)</button>
                <button onclick="Game.crafting.craftFurniture('table')" class="btn-animal btn-craft">ğŸªµ Table (4ğŸªµ)</button>
                <button onclick="Game.crafting.craftFurniture('bookshelf')" class="btn-animal btn-craft">ğŸ“š Biblio (5ğŸªµ,2ğŸ§±)</button>
                <button onclick="Game.crafting.craftFurniture('plant')" class="btn-animal btn-craft">ğŸª´ Plante (3ğŸ§±)</button>
                <button onclick="Game.crafting.craftFurniture('bed')" class="btn-animal btn-craft">ğŸ›ï¸ Lit (6ğŸªµ)</button>
                <button onclick="Game.crafting.craftFurniture('lamp')" class="btn-animal btn-craft">ğŸ’¡ Lampe (1ğŸªµ,2ğŸ§±)</button>
                <button onclick="Game.crafting.craftFurniture('mirror')" class="btn-animal btn-craft">ğŸª Miroir (2ğŸªµ,3ğŸ§±)</button>
            </div>
            <div style="color:white;background:rgba(0,0,0,0.5);padding:4px 16px;border-radius:999px;font-size:0.7rem;">
                Marche sur le tapis ğŸŒŸ pour sortir
            </div>
        </div>
    </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• Main HUD â•â•â•â•â•â•â•â•â•â•â• -->

<!-- Top-left: Status -->
<div id="status-panel" style="position:fixed;top:10px;left:10px;z-index:1000;display:flex;flex-direction:column;gap:8px;max-width:240px;">
    <!-- Charlie Info -->
    <div class="ui-card" style="padding:10px;">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;">
            <span style="color:#e65100;font-weight:bold;font-size:1rem;">ğŸ¤  Charlie</span>
            <span id="level-display" style="color:#ff9d5c;font-weight:bold;font-size:0.8rem;">Nv. 1</span>
        </div>

        <!-- XP Bar -->
        <div class="xp-bar">
            <div class="xp-bar-fill" id="xp-bar-fill"></div>
        </div>
        <div id="xp-text" style="font-size:0.6rem;color:#8b6914;text-align:right;">0/100 XP</div>

        <!-- Inventory Grid -->
        <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:1px 8px;font-size:0.7rem;margin-top:4px;">
            <span>ğŸ Pommes:</span> <span id="apple-count" style="font-weight:bold;color:#e53935;text-align:right;">0</span>
            <span>ğŸªµ Bois:</span>   <span id="wood-count" style="font-weight:bold;color:#795548;text-align:right;">0</span>
            <span>ğŸ§± Pierre:</span> <span id="stone-count" style="font-weight:bold;color:#757575;text-align:right;">0</span>
            <span>ğŸ Pains:</span>  <span id="bread-count" style="font-weight:bold;color:#bf8c3e;text-align:right;">0</span>
            <span>ğŸŸ Poissons:</span> <span id="fish-count" style="font-weight:bold;color:#1e88e5;text-align:right;">0</span>
            <span>ğŸŒ» Fleurs:</span> <span id="flower-count" style="font-weight:bold;color:#e91e63;text-align:right;">0</span>
            <span>ğŸ¦‹ Papillons:</span> <span id="butterfly-count" style="font-weight:bold;color:#7c4dff;text-align:right;">0</span>
        </div>
        <div style="display:flex;justify-content:space-between;font-size:0.75rem;border-top:1px solid #e8e2c8;margin-top:3px;padding-top:3px;">
            <span>ğŸ’° Clochettes:</span> <span id="money-count" style="font-weight:bold;color:#f9a825;">0</span>
        </div>
        <div style="display:flex;justify-content:space-between;font-size:0.75rem;">
            <span>ğŸ”¨ MatÃ©riaux:</span> <span id="material-count" style="font-weight:bold;color:#42a5f5;">0</span>
        </div>

        <!-- Cooked Items -->
        <div id="cooked-items" style="font-size:0.7rem;margin-top:2px;"></div>
        <!-- Seeds -->
        <div id="seeds-display" style="font-size:0.7rem;margin-top:2px;"></div>

        <!-- Tools -->
        <div id="toolbar" style="display:flex;gap:4px;margin-top:4px;"></div>

        <!-- Plant button -->
        <button id="plant-btn" onclick="Game.entities.plantFlower()" class="btn-animal hidden" style="width:100%;margin-top:6px;font-size:0.7rem;background:#e91e63;box-shadow:0 3px 0 #c2185b;">Planter une fleur ğŸŒ·</button>

        <!-- Save buttons -->
        <div class="save-btns" style="margin-top:6px;">
            <button onclick="Game.saveGame();Game.ui.notify('SauvegardÃ© ! ğŸ’¾')">ğŸ’¾ Sauver</button>
            <button onclick="Game.audio.toggleMute();this.textContent=Game.audio.isMuted()?'ğŸ”‡ Son':'ğŸ”Š Son'">ğŸ”Š Son</button>
            <button id="shovel-toggle" onclick="Game.tools.toggleShovel()">â›ï¸ Pelle OFF</button>
        </div>
    </div>

    <!-- Clock & Season -->
    <div class="ui-card" style="padding:8px;">
        <div class="info-bar">
            <span class="info-badge" id="clock-display">08:00</span>
            <span class="info-badge" id="phase-display">Jour â˜€ï¸</span>
            <span class="info-badge" id="season-display">Printemps ğŸŒ±</span>
            <span class="info-badge" id="weather-display">â›… DÃ©gagÃ©</span>
        </div>
    </div>

    <!-- Quest Tracker -->
    <div class="ui-card" style="padding:8px;">
        <div style="font-size:0.7rem;font-weight:bold;color:#e65100;margin-bottom:2px;">ğŸ“‹ QuÃªtes</div>
        <div id="quest-tracker"></div>
    </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• Action Panels (bottom-right) â•â•â•â•â•â•â•â•â•â•â• -->

<div id="action-fountain" style="position:fixed;bottom:80px;right:10px;z-index:1000;display:none;flex-direction:column;gap:6px;">
    <button onclick="Game.inventory.sellAll()" class="btn-animal" style="background:#42a5f5;box-shadow:0 4px 0 #1e88e5;">Tout vendre â›²</button>
    <button onclick="Game.inventory.collectVillageRevenue()" class="btn-animal" style="background:#66bb6a;box-shadow:0 4px 0 #43a047;">Revenus village : <span id="village-revenue">0</span>ğŸ’°</button>
</div>

<div id="action-bakery" style="position:fixed;bottom:80px;right:10px;z-index:1000;display:none;flex-direction:column;gap:6px;">
    <button id="bake-btn" onclick="Game.inventory.bakeBread()" class="btn-animal" style="background:#bf8c3e;box-shadow:0 4px 0 #a67c2e;">Cuire du Pain ğŸ</button>
    <!-- Cooking recipes -->
    <div class="ui-card" style="padding:8px;max-width:200px;" id="cooking-panel">
        <div style="font-size:0.7rem;font-weight:bold;color:#e65100;margin-bottom:4px;">ğŸ³ Cuisine</div>
        <div id="cooking-recipes"></div>
    </div>
</div>

<div id="action-shop" style="position:fixed;bottom:80px;right:10px;z-index:1000;display:none;flex-direction:column;gap:6px;">
    <div class="ui-card" style="padding:10px;max-width:220px;">
        <div style="font-size:0.8rem;font-weight:bold;color:#e65100;margin-bottom:6px;">ğŸª Magasin</div>
        <div id="shop-items"></div>
    </div>
</div>

<div id="action-river" style="position:fixed;bottom:80px;right:10px;z-index:1000;display:none;flex-direction:column;gap:6px;">
    <button id="fish-btn" onclick="Game.inventory.startFishing()" class="btn-animal" style="background:#00acc1;box-shadow:0 4px 0 #00838f;">PÃªcher ğŸ£</button>
</div>

<div id="action-fishShop" style="position:fixed;bottom:80px;right:10px;z-index:1000;display:none;flex-direction:column;gap:6px;">
    <div class="ui-card" style="padding:10px;max-width:240px;">
        <div style="font-size:0.8rem;font-weight:bold;color:#1e88e5;margin-bottom:6px;">ğŸŸ Poissonnerie d'OrdralfabÃ©tix</div>
        <div style="font-size:0.7rem;margin-bottom:6px;">
            Stock : <span id="fishShop-stock">0</span> ğŸŸ | Revenus : <span id="fishShop-revenue">0</span> ğŸ’°
        </div>
        <button onclick="Game.inventory.depositFish()" class="btn-animal" style="background:#00acc1;box-shadow:0 4px 0 #00838f;width:100%;margin-bottom:4px;">DÃ©poser mes poissons ğŸŸ</button>
        <button onclick="Game.inventory.collectFishRevenue()" class="btn-animal" style="background:#f9a825;box-shadow:0 4px 0 #f57f17;width:100%;">Collecter les revenus ğŸ’°</button>
    </div>
</div>

<div id="action-museum" style="position:fixed;bottom:80px;right:10px;z-index:1000;display:none;flex-direction:column;gap:6px;">
    <div class="ui-card" style="padding:10px;max-width:280px;max-height:60vh;overflow-y:auto;">
        <div style="font-size:0.8rem;font-weight:bold;color:#7c4dff;margin-bottom:4px;">ğŸ›ï¸ MusÃ©e â€” <span id="museum-count">0/13</span></div>
        <div style="font-size:0.7rem;font-weight:bold;color:#1e88e5;margin-bottom:2px;">Poissons</div>
        <div id="museum-fish" style="display:flex;flex-wrap:wrap;gap:4px;margin-bottom:6px;"></div>
        <div style="font-size:0.7rem;font-weight:bold;color:#7c4dff;margin-bottom:2px;">Papillons</div>
        <div id="museum-butterflies" style="display:flex;flex-wrap:wrap;gap:4px;"></div>
    </div>
</div>

<!-- Mobile toggle button -->
<button id="mobile-toggle" onclick="toggleMobileUI()" style="display:none;position:fixed;top:10px;left:50%;transform:translateX(-50%);z-index:1001;background:#ff9d5c;color:white;border:none;border-radius:50%;width:44px;height:44px;font-size:1.2rem;box-shadow:0 4px 8px rgba(0,0,0,0.2);cursor:pointer;">ğŸ“Š</button>

<!-- â•â•â•â•â•â•â•â•â•â•â• Time Controls (top-right) â•â•â•â•â•â•â•â•â•â•â• -->
<div style="position:fixed;top:10px;right:10px;z-index:1000;">
    <div class="ui-card" style="padding:6px 10px;display:flex;gap:4px;align-items:center;font-size:0.65rem;">
        <button id="pause-btn" onclick="Game.time.togglePause()" style="background:#e8e2c8;border:1px solid #d4c9a8;border-radius:6px;padding:2px 6px;cursor:pointer;font-size:0.7rem;">â¸ï¸</button>
        <button onclick="Game.time.setSpeed(1)" style="background:#e8e2c8;border:1px solid #d4c9a8;border-radius:6px;padding:2px 6px;cursor:pointer;">x1</button>
        <button onclick="Game.time.setSpeed(2)" style="background:#e8e2c8;border:1px solid #d4c9a8;border-radius:6px;padding:2px 6px;cursor:pointer;">x2</button>
        <button onclick="Game.time.setSpeed(4)" style="background:#e8e2c8;border:1px solid #d4c9a8;border-radius:6px;padding:2px 6px;cursor:pointer;">x4</button>
        <span id="speed-display" style="color:#8b6914;font-weight:bold;">x1</span>
    </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• Joystick (center-bottom on mobile) â•â•â•â•â•â•â•â•â•â•â• -->

<div id="joystick">
    <div></div>
    <button class="btn-animal btn-joystick">â†‘</button>
    <div></div>
    <button class="btn-animal btn-joystick">â†</button>
    <button class="btn-animal btn-joystick">â†“</button>
    <button class="btn-animal btn-joystick">â†’</button>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• Scripts â•â•â•â•â•â•â•â•â•â•â• -->
<script src="js/config.js"></script>
<script src="js/state.js"></script>
<script src="js/particles.js"></script>
<script src="js/audio.js"></script>
<script src="js/xp.js"></script>
<script src="js/time.js"></script>
<script src="js/weather.js"></script>
<script src="js/player.js"></script>
<script src="js/world.js"></script>
<script src="js/entities.js"></script>
<script src="js/buildings.js"></script>
<script src="js/villagers.js"></script>
<script src="js/inventory.js"></script>
<script src="js/crafting.js"></script>
<script src="js/quests.js"></script>
<script src="js/tools.js"></script>
<script src="js/farming.js"></script>
<script src="js/minimap.js"></script>
<script src="js/creatures.js"></script>
<script src="js/titlescreen.js"></script>
<script src="js/engine.js"></script>
<script src="js/ui.js"></script>

<script>
// â”€â”€ Mobile UI Toggle â”€â”€
let mobileUIVisible = true;

function toggleMobileUI() {
    const panel = document.getElementById('status-panel');
    const btn = document.getElementById('mobile-toggle');
    mobileUIVisible = !mobileUIVisible;

    if (mobileUIVisible) {
        panel.style.display = 'flex';
        btn.textContent = 'ğŸ“Š';
    } else {
        panel.style.display = 'none';
        btn.textContent = 'ğŸ‘ï¸';
    }
}

// Detect mobile and show toggle button
function detectMobile() {
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)
                     || window.innerWidth <= 768;

    if (isMobile) {
        const toggleBtn = document.getElementById('mobile-toggle');
        if (toggleBtn) {
            toggleBtn.style.display = 'block';
        }

        // Start with UI hidden on very small screens
        if (window.innerWidth <= 480) {
            const panel = document.getElementById('status-panel');
            if (panel) {
                panel.style.display = 'none';
                mobileUIVisible = false;
                toggleBtn.textContent = 'ğŸ‘ï¸';
            }
        }
    }
}

// Call on load and resize
window.addEventListener('resize', detectMobile);

// â”€â”€ Main bootstrap â”€â”€
(function(){
"use strict";

// Start the game (called after title screen)
Game.startGame = function() {
    // Initialize all systems
    Game.audio.init();
    Game.time.init();
    Game.weather.init();
    Game.particles.init();

    // Build world
    Game.world.init();
    Game.player.init();
    Game.entities.init();
    Game.villagers.init();
    Game.creatures.init();
    Game.minimap.init();

    // Init UI
    Game.ui.init();
    Game.engine.init();

    // Build cooking recipes UI
    buildCookingUI();

    // Start loops
    Game.engine.start();
    Game.audio.startAmbient();
    Game.startAutoSave();
};

function buildCookingUI() {
    var el = document.getElementById('cooking-recipes');
    if (!el) return;
    var html = '';
    for (var id in Game.COOKING_RECIPES) {
        var r = Game.COOKING_RECIPES[id];
        var needStr = '';
        for (var item in r.need) {
            var icons = { apples: 'ğŸ', fish: 'ğŸŸ', flowers: 'ğŸŒ»', bread: 'ğŸ' };
            needStr += (icons[item] || item) + r.need[item] + ' ';
        }
        html += '<button class="cook-btn" onclick="Game.crafting.cook(\'' + id + '\')">' +
            r.emoji + ' ' + r.label + ' (' + needStr.trim() + ') Nv.' + r.level + '</button>';
    }
    el.innerHTML = html;
}

// On page load â†’ show title screen
window.onload = function() {
    detectMobile();
    Game.titlescreen.show();
};

})();
</script>

</body>
</html>
